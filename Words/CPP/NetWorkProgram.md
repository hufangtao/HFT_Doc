---
title: 网络编程
---
<!-- TOC -->

- [TODO List](#todo-list)
- [基本概念](#基本概念)
    - [同步与异步](#同步与异步)

<!-- /TOC -->

## TODO List
1. IO模型C++代码

## 基本概念

### 同步与异步
```
同步是指一个任务的完成需要依赖另外一个任务时，只有等待被依赖的任务完成后，依赖的任务才能算完成。
```
```
异步是指不需要等待被依赖的任务完成，只是通知被依赖的任务要完成什么工作。然后继续执行下面代码逻辑，只要自己完成了整个任务就算完成了（异步一般使用状态、通知和回调）
```
```
区别：读写数据的方式不同。
同步：主动拷贝IO数据到用户进程
异步：只要拷贝IO数据完成的通知，拷贝过程由内核完成
```

### 阻塞与非阻塞
```
阻塞是指调用结果返回之前，当前线程会被挂起，一直处于等待消息通知，不能够执行其他业务
```
```
非阻塞是指在不能立刻得到结果之前，该函数不会阻塞当前线程，而会立刻返回
```
```
区别：需要访问的IO数据未就绪的情况下，是否需要等待
```

## IO模型
```
一个输入操作通常包括两个不同阶段：
1. 等待数据准备好；例如：等待数据报分组到达
2. 从内核向进程复制数据
```

由于存在这两个阶段，Linux产生了下面五种IO模型（以socket为例）
1. 阻塞式IO

   - 当用户进程调用了recvfrom等方法时，内核进入IO的第1个阶段：准备数据（内核需要等待足够的数据再拷贝）这个过程需要等待，用户进程阻塞等待内核将数据准备好。然后用户进程同步拷贝到用户地址空间。

2. 非阻塞IO
   - 用户进程发起`read`请求，如果内核种的数据还没有准备好，那么它不会阻塞等待，而是立即返回一个`error`：EWOULDBLOCK、EAGAIN
   - 用户进程判断是一个`error`时，进程知道数据还没准备好，于是它可以再次发送`read`请求
   - 在某次`read`请求时，发现数据已经准备好，那么同步将数据拷贝到用户内存
   - 非阻塞IO模式下，用户进程需要轮询查看Linux内核是否准备好了
      
      ![blockchain](https://github.com/hufangtao/HFT_Doc/blob/master/Pictures/1127869-20181210212858009-948984805.png?raw=true "图片hover描述")
3. IO多路复用
   - 通过一种机制，一个进程同时监视多个文件描述符。一旦某个文件描述符就绪，能够通知程序进行响应的读写操作，而不需要程序轮询。
   - 常用的IO多路复用：`select`、`poll`和`epoll`
      
      ![blockchain](https://github.com/hufangtao/HFT_Doc/blob/master/Pictures/1127869-20181210212908314-1267377747.png?raw=true "图片hover描述")

4. 信号驱动IO
   - 内核文件描述符就绪之后，通过信号通知用户进程，用户进程通过系统调用读取数据
   - 此方法属于同步IO，因为从内核到用户空间的读取是由用户进程负责的，一般用信号量实现。
      
      ![blockchain](https://github.com/hufangtao/HFT_Doc/blob/master/Pictures/1127869-20181210212934040-13536334.png?raw=true "图片hover描述")
5. 异步IO（POSIX的aio_系列函数）
   - 用户进程发起read操作之后，立即就开始去做其他事情。内核收到一个异步`IO read`之后，不会阻塞用户进程
   - 内核等待数据准备完成，然后将数据拷贝到用户内存。当一切都完成之后，内核向用户进程发送一个`signal`，通知用户进程`read`操作完成
      
      ![blockchain](https://github.com/hufangtao/HFT_Doc/blob/master/Pictures/1127869-20181210212944334-1184572641.png?raw=true "图片hover描述")

同步： IO复用 select/poll/epoll
异步： Linux：AIO  Windos：IOCP  其它一些网络库

## 网络库

### Boost ASIO


## 参考
5种IO模型 [https://www.cnblogs.com/dunitian/p/10099343.html](https://www.cnblogs.com/dunitian/p/10099343.html "超链接hover描述")

